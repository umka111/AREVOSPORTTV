<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>AREVO SPORT Portal</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<!-- Firebase compat SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
<style>
:root{--g1:#0ea955;--g2:#ffd400;--bg:#04110f;--card:rgba(255,255,255,0.03);font-family:Montserrat,system-ui,sans-serif}
*{box-sizing:border-box}body{margin:0;background:#04110f;color:#fff}
.container{max-width:1100px;margin:14px auto;padding:12px}
header{display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:12px;background:linear-gradient(135deg,var(--g1),var(--g2));}
.brand{display:flex;align-items:center;gap:12px}.logo{width:52px;height:52px;border-radius:10px;background:linear-gradient(180deg,#042,var(--g2));display:flex;align-items:center;justify-content:center;color:#042;font-weight:800;font-size:20px}
nav{display:flex;gap:10px;align-items:center}.navlink,.admin-btn{background:rgba(255,255,255,0.9);padding:8px 12px;border-radius:8px;font-weight:700;color:#032;text-decoration:none;cursor:pointer}
.main{display:grid;grid-template-columns:1fr 320px;gap:16px;margin-top:16px}
.card{background:var(--card);padding:12px;border-radius:12px}
.player{height:320px;border-radius:10px;overflow:hidden;background:#000;position:relative}
video{width:100%;height:100%;object-fit:cover}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:12px;margin-top:12px}
.channel{border-radius:10px;background:rgba(255,255,255,0.04);padding:8px}
.poster{height:140px;background-size:cover;background-position:center;border-radius:8px}
.title{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
.epg{margin-top:8px;background:rgba(0,0,0,0.25);padding:8px;border-radius:8px;font-size:13px}
.epg-item{display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px dashed rgba(255,255,255,0.1)}
.footer{margin-top:18px;text-align:center;color:rgba(255,255,255,0.6);padding:12px}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.5);backdrop-filter:blur(6px);z-index:1000}
.modal.open{display:flex}
.modal-card{width:340px;background:#111;padding:16px;border-radius:10px}
#adminPage{display:none;margin-top:12px}
#adminPage.active{display:block}
.input{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.2);background:transparent;color:#fff;margin-bottom:8px}
.btn{padding:6px 10px;border-radius:8px;border:none;background:var(--g1);color:#042;font-weight:700;cursor:pointer;margin:2px}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.3);color:var(--g2)}
@media(max-width:980px){.main{grid-template-columns:1fr}.player{height:200px}}
</style>
</head>
<body>
<div class="container">
  <header>
    <div class="brand"><div class="logo">A</div><div><strong>AREVO SPORT</strong></div></div>
    <nav>
      <a class="navlink" href="#" onclick="showPage('home')">Home</a>
      <a class="navlink" href="#" onclick="showPage('about')">About</a>
      <button class="admin-btn" id="openAdminBtn">Admin</button>
    </nav>
  </header>

  <main id="home" class="main">
    <section class="card">
      <h3 id="liveName">AREVO SPORT</h3>
      <div class="player"><video id="video" controls playsinline></video><div id="fallback" style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center">Select channel</div></div>
      <h4>Channels</h4>
      <div id="channelsGrid" class="grid"></div>
    </section>
    <aside class="card">
      <h4>Ads</h4>
      <div id="adsArea"></div>
      <h4 style="margin-top:10px">Stats</h4>
      <div>Total Views: <span id="viewsCount">0</span></div>
    </aside>
  </main>

  <section id="about" style="display:none" class="card"><h2>About</h2><p>Ushbu sayt AREVO jamoasi tomonidan ishlangan</p></section>

  <section id="adminPage" class="card"><h2>Admin Panel</h2>
    <div><h3>Add Channel</h3><input id="ch_name" class="input" placeholder="Name"><input id="ch_poster" class="input" placeholder="Poster URL"><input id="ch_m3u8" class="input" placeholder=".m3u8 link"><button class="btn" id="addChannelBtn">Add</button></div>
    <div id="channelsAdmin"></div>
    <div><h3>Add EPG</h3><select id="epg_channel" class="input"></select><input id="epg_title" class="input" placeholder="Title"><input id="epg_time" type="datetime-local" class="input"><button class="btn" id="addEpgBtn">Add</button></div>
    <div id="epgAdmin"></div>
    <div><h3>Add Ad</h3><input id="ad_title" class="input" placeholder="Ad title"><input id="ad_img" class="input" placeholder="Image URL"><input id="ad_link" class="input" placeholder="Link"><button class="btn" id="addAdBtn">Add</button></div>
    <div id="adsAdmin"></div>
    <div><h3>Statistics</h3><p>Total Views: <span id="adminViews">0</span></p></div>
  </section>

  <div class="footer">Â© <span id="year"></span> AREVO SPORT</div>
</div>

<div class="modal" id="adminModal"><div class="modal-card"><h3>Admin Access</h3><input id="adminCode" type="password" class="input" placeholder="Code"><button class="btn" id="adminOk">Enter</button></div></div>

<script>
const firebaseConfig={
  apiKey:"AIzaSyBAn3hf1-X-Mgp40duo4bn6TkB32HVyEoQ",
  authDomain:"arevosport.firebaseapp.com",
  projectId:"arevosport",
  storageBucket:"arevosport.appspot.com",
  messagingSenderId:"164870393057",
  appId:"1:164870393057:web:610f6fde3cd7b40482fba0",
  measurementId:"G-SLDJK7F46L"
};
firebase.initializeApp(firebaseConfig);
const fs=firebase.firestore();
const rtdb=firebase.database();
const ADMIN_CODE="ARVILY01";

let hls;

// Stats
const viewsRef=rtdb.ref("stats/views");
viewsRef.transaction(v=>(v||0)+1);
viewsRef.on("value",snap=>{const v=snap.val()||0;document.getElementById("viewsCount").textContent=v;document.getElementById("adminViews").textContent=v;});

// Data listeners
fs.collection("channels").onSnapshot(snap=>{
  const arr=[];snap.forEach(d=>arr.push({id:d.id,...d.data()}));
  renderChannels(arr);
  populateEpgSelect(arr);
  renderChannelsAdmin(arr);
});
fs.collection("epg").onSnapshot(snap=>{
  const arr=[];snap.forEach(d=>arr.push({id:d.id,...d.data()}));
  renderSchedule(arr);
  renderEpgAdmin(arr);
});
fs.collection("ads").onSnapshot(snap=>{
  const arr=[];snap.forEach(d=>arr.push({id:d.id,...d.data()}));
  renderAds(arr);
  renderAdsAdmin(arr);
});

// Rendering
function renderChannels(ch){const g=document.getElementById("channelsGrid");g.innerHTML="";ch.forEach(c=>{const div=document.createElement("div");div.className="channel";div.innerHTML=`<div class="poster" style="background-image:url('${c.poster||''}')"></div><div class="title"><strong>${c.name}</strong><button class="btn" onclick="playStream('${c.m3u8}','${c.name}')">Play</button></div><div class="epg" id="epg_${c.id}"></div>`;g.appendChild(div);});updateChannelEpg();}
function renderSchedule(epg){window.allEpg=epg;updateChannelEpg();}
function updateChannelEpg(){if(!window.allEpg)return;document.querySelectorAll('[id^=epg_]').forEach(e=>e.innerHTML="");window.allEpg.forEach(e=>{const box=document.getElementById("epg_"+e.channelId);if(box){box.innerHTML+=`<div class='epg-item'><span>${e.title}</span><span>${new Date(e.time?.seconds?e.time.seconds*1000:e.time).toLocaleString()}</span></div>`}});}
function renderAds(ads){const a=document.getElementById("adsArea");a.innerHTML="";ads.forEach(ad=>{a.innerHTML+=`<div style="margin:6px 0;cursor:pointer" onclick="window.open('${ad.link}')"><img src="${ad.image}" style="width:100%;border-radius:6px"></div>`});}
function playStream(url,name){const video=document.getElementById("video");const fallback=document.getElementById("fallback");document.getElementById("liveName").textContent=name||"AREVO SPORT";fallback.style.display="none";if(hls){hls.destroy();}if(Hls.isSupported()){hls=new Hls();hls.loadSource(url);hls.attachMedia(video);}else if(video.canPlayType("application/vnd.apple.mpegurl")){video.src=url;}else{alert("HLS not supported");}}

// CRUD
document.getElementById("addChannelBtn").onclick=async()=>{const n=document.getElementById("ch_name").value;const p=document.getElementById("ch_poster").value;const m=document.getElementById("ch_m3u8").value;await fs.collection("channels").add({name:n,poster:p,m3u8:m});};
document.getElementById("addEpgBtn").onclick=async()=>{const ch=document.getElementById("epg_channel").value;const t=document.getElementById("epg_title").value;const time=document.getElementById("epg_time").value;const d=await fs.collection("channels").doc(ch).get();await fs.collection("epg").add({channelId:ch,channelName:d.data().name,title:t,time:firebase.firestore.Timestamp.fromDate(new Date(time))});};
document.getElementById("addAdBtn").onclick=async()=>{const ti=document.getElementById("ad_title").value;const img=document.getElementById("ad_img").value;const l=document.getElementById("ad_link").value;await fs.collection("ads").add({title:ti,image:img,link:l});};

function renderChannelsAdmin(ch){const box=document.getElementById("channelsAdmin");box.innerHTML="<h3>Manage Channels</h3>";ch.forEach(c=>{box.innerHTML+=`<div>${c.name} <button class='btn' onclick="deleteChannel('${c.id}')">Delete</button></div>`});}
function renderEpgAdmin(epg){const box=document.getElementById("epgAdmin");box.innerHTML="<h3>Manage EPG</h3>";epg.forEach(e=>{box.innerHTML+=`<div>${e.title} (${e.channelName}) <button class='btn' onclick="deleteEpg('${e.id}')">Delete</button></div>`});}
function renderAdsAdmin(ads){const box=document.getElementById("adsAdmin");box.innerHTML="<h3>Manage Ads</h3>";ads.forEach(ad=>{box.innerHTML+=`<div>${ad.title} <button class='btn' onclick="deleteAd('${ad.id}')">Delete</button></div>`});}

async function deleteChannel(id){await fs.collection("channels").doc(id).delete();}
async function deleteEpg(id){await fs.collection("epg").doc(id).delete();}
async function deleteAd(id){await fs.collection("ads").doc(id).delete();}

function populateEpgSelect(ch){const s=document.getElementById("epg_channel");s.innerHTML="";ch.forEach(c=>{s.innerHTML+=`<option value="${c.id}">${c.name}</option>`});}

// Admin modal
document.getElementById("openAdminBtn").onclick=()=>document.getElementById("adminModal").classList.add("open");
document.getElementById("adminOk").onclick=()=>{if(document.getElementById("adminCode").value===ADMIN_CODE){document.getElementById("adminModal").classList.remove("open");document.getElementById("adminPage").classList.add("active");document.querySelector(".main").style.display="none";}else alert("Wrong code");};
function showPage(id){["home","about"].forEach(p=>document.getElementById(p).style.display="none");document.getElementById(id).style.display="block";}
document.getElementById("year").textContent=new Date().getFullYear();
</script>
</body>
</html>
